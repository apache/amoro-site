




























<!DOCTYPE html>
<html>
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <title>Using Tables</title>

    
    















<link href="../css/bootstrap.css" rel="stylesheet">


<link href="../css/markdown.css" rel="stylesheet">
<link href="../css/katex.min.css" rel="stylesheet">





<link href="../css/amoro-theme.css" rel="stylesheet">


<link href="../font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic,700italic" rel="stylesheet" type="text/css">


<link href="../css/termynal.css" rel="stylesheet">

<link href="../css/home-page.css" rel="stylesheet">


    
    
    

</head>
<body>

<head>
    <script>
        
        function addAnchor(element) {
            element.insertAdjacentHTML('beforeend', `<a href="#${element.id}" class="anchortag" ariaLabel="Anchor"> ðŸ”— </a>` )
        }
        document.addEventListener('DOMContentLoaded', function () {
            var headers = document.querySelectorAll('h1[id], h2[id], h3[id], h4[id]')
            if (headers) {
                headers.forEach(addAnchor)
            }
        });
    </script>
</head>















    <nav class="navbar navbar-default" role="navigation">
        <topsection>
            <div class="navbar-fixed-top">
                <div>
                <a class="page-scroll navbar-brand" href="https://amoro.apache.org/"><img class="top-navbar-logo" src="https://amoro.apache.org/docs/version_bump_when_releasing//img/amoro-logo-icon.png"/></a>
                </div>
            </div>
            <div class="navbar-menu-fixed-top navbar-pages-group">
                
                
                
                
                
                    <div class="topnav-page-selection">
                        <a   href="https://amoro.apache.org/docs/version_bump_when_releasing/../../quick-start/">Quickstart</a>
                    </div class="topnav-page-selection">
                
                
                
                
                    
                    <div class="versions-dropdown">
                    <div class="topnav-page-selection">
                        <a   href="">Docs</a> <i class="fa fa-caret-down"></i>
                    </div class="topnav-page-selection">
                        <div class="versions-dropdown-content">
                        <ul>
                        
                            <li class="topnav-page-selection">
                            <a   href="https://amoro.apache.org/docs/version_bump_when_releasing/../../docs/latest/">latest</a>
                            </li class="topnav-page-selection">
                        
                            <li class="topnav-page-selection">
                            <a   href="https://amoro.apache.org/docs/version_bump_when_releasing/../../docs/0.8.1/">0.8.1-incubating</a>
                            </li class="topnav-page-selection">
                        
                            <li class="topnav-page-selection">
                            <a   href="https://amoro.apache.org/docs/version_bump_when_releasing/../../docs/0.8.0/">0.8.0-incubating</a>
                            </li class="topnav-page-selection">
                        
                            <li class="topnav-page-selection">
                            <a   href="https://amoro.apache.org/docs/version_bump_when_releasing/../../docs/0.7.1/">0.7.1-incubating</a>
                            </li class="topnav-page-selection">
                        
                            <li class="topnav-page-selection">
                            <a   href="https://amoro.apache.org/docs/version_bump_when_releasing/../../docs/0.7.0/">0.7.0-incubating</a>
                            </li class="topnav-page-selection">
                        
                            <li class="topnav-page-selection">
                            <a   href="https://amoro.apache.org/docs/version_bump_when_releasing/../../docs/0.6.1/">0.6.1</a>
                            </li class="topnav-page-selection">
                        
                        </ul>
                        </div>
                    </div>
                
                
                
                
                    
                    <div class="versions-dropdown">
                    <div class="topnav-page-selection">
                        <a   href="">Benchmark</a> <i class="fa fa-caret-down"></i>
                    </div class="topnav-page-selection">
                        <div class="versions-dropdown-content">
                        <ul>
                        
                            <li class="topnav-page-selection">
                            <a   href="https://amoro.apache.org/docs/version_bump_when_releasing/../../benchmark-report/">Benchmark Report</a>
                            </li class="topnav-page-selection">
                        
                            <li class="topnav-page-selection">
                            <a   href="https://amoro.apache.org/docs/version_bump_when_releasing/../../benchmark-guide/">Benchmark Guide</a>
                            </li class="topnav-page-selection">
                        
                        </ul>
                        </div>
                    </div>
                
                
                
                
                    <div class="topnav-page-selection">
                        <a   href="https://amoro.apache.org/docs/version_bump_when_releasing/../../download/">Download</a>
                    </div class="topnav-page-selection">
                
                
                
                
                    <div class="topnav-page-selection">
                        <a   href="https://amoro.apache.org/docs/version_bump_when_releasing/../../roadmap/">Roadmap</a>
                    </div class="topnav-page-selection">
                
                
                
                
                    
                    <div class="versions-dropdown">
                    <div class="topnav-page-selection">
                        <a   href="">Community</a> <i class="fa fa-caret-down"></i>
                    </div class="topnav-page-selection">
                        <div class="versions-dropdown-content">
                        <ul>
                        
                            <li class="topnav-page-selection">
                            <a   href="https://amoro.apache.org/docs/version_bump_when_releasing/../../join-community/">Join Community</a>
                            </li class="topnav-page-selection">
                        
                            <li class="topnav-page-selection">
                            <a   href="https://amoro.apache.org/docs/version_bump_when_releasing/../../how-to-contribute/">How to contribute</a>
                            </li class="topnav-page-selection">
                        
                        </ul>
                        </div>
                    </div>
                
                
                
                
                    
                    <div class="versions-dropdown">
                    <div class="topnav-page-selection">
                        <a   href="">ASF</a> <i class="fa fa-caret-down"></i>
                    </div class="topnav-page-selection">
                        <div class="versions-dropdown-content">
                        <ul>
                        
                            <li class="topnav-page-selection">
                            <a  target="_blank" href="https://www.apache.org/">Foundation</a>
                            </li class="topnav-page-selection">
                        
                            <li class="topnav-page-selection">
                            <a  target="_blank" href="https://www.apache.org/licenses/">License</a>
                            </li class="topnav-page-selection">
                        
                            <li class="topnav-page-selection">
                            <a  target="_blank" href="https://www.apache.org/foundation/sponsorship.html">Donate</a>
                            </li class="topnav-page-selection">
                        
                            <li class="topnav-page-selection">
                            <a  target="_blank" href="https://www.apache.org/foundation/thanks.html">Sponsors</a>
                            </li class="topnav-page-selection">
                        
                            <li class="topnav-page-selection">
                            <a  target="_blank" href="https://www.apache.org/security/">Security</a>
                            </li class="topnav-page-selection">
                        
                            <li class="topnav-page-selection">
                            <a  target="_blank" href="https://privacy.apache.org/policies/privacy-policy-public.html">Privacy</a>
                            </li class="topnav-page-selection">
                        
                        </ul>
                        </div>
                    </div>
                
                
                <div class="topnav-page-selection">
                    <a href="https://github.com/apache/incubator-amoro" target="_blank">
                        <img src="https://amoro.apache.org/docs/version_bump_when_releasing//img/GitHub-Mark.png" target="_blank" class="top-navbar-logo"/>
                    </a>
                </div>
            </div>
            </topsection>
    </nav>

<body dir=" ltr">
    <section>
        <div class="grid-container leftnav-and-toc">
            
                














<div class="sidebar markdown-body">
    <div id="sidebar-full">
        














  <div>
        <input type="search" class="form-control" id="search-input" placeholder="Search docs..." maxlength="64" data-hotkeys="s/">
  </div>


        













<section>
    <div id="search-results-container">
        <ul id="search-results"></ul>
    </div>
</section>
    <div class="sidebar-menu">
    <ul>
        

        
        
        
            
                <li>
                    <a class="top-menu" id=""  href="../">
                        <span>Introduction</span>
                    </a>
                </li>
            
        
        
        
            
                <li>


                    <a class="top-menu chevron-toggle  collapsed" data-toggle="collapse" href="#Concepts">
                        <span>Concepts</span>
                    </a>
                </li>
        <div id="Concepts" class="collapse in">
                <ul class="sub-menu">
                    
                        <li>
                            <a href="../catalogs/">Catalogs</a>
                        </li>
                    
                        <li>
                            <a href="../self-optimizing/">Self-Optimizing</a>
                        </li>
                    
                        <li>
                            <a href="../table-watermark/">Table Watermark</a>
                        </li>
                    
                </ul>
        </div>
            
        
        
        
            
                <li>


                    <a class="top-menu chevron-toggle  collapsed" data-toggle="collapse" href="#Admin_Guides">
                        <span>Admin Guides</span>
                    </a>
                </li>
        <div id="Admin_Guides" class="collapse in">
                <ul class="sub-menu">
                    
                        <li>
                            <a href="../deployment/">Deployment</a>
                        </li>
                    
                        <li>
                            <a href="../deployment-on-kubernetes/">Deployment On Kubernetes</a>
                        </li>
                    
                        <li>
                            <a href="../managing-catalogs/">Managing Catalogs</a>
                        </li>
                    
                        <li>
                            <a href="../managing-optimizers/">Managing Optimizers</a>
                        </li>
                    
                        <li>
                            <a href="../using-customized-encryption-method/">Using Customized Encryption Method for Configurations</a>
                        </li>
                    
                        <li>
                            <a href="../using-kyuubi/">Using Kyuubi By Terminal</a>
                        </li>
                    
                </ul>
        </div>
            
        
        
        
            
                <li>


                    <a class="top-menu chevron-toggle " data-toggle="collapse" href="#User_Guides">
                        <span>User Guides</span>
                    </a>
                </li>
        <div id="User_Guides" class="collapse in">
                <ul class="sub-menu">
                    
                        <li>
                            <a href="../using-tables/">Using Tables</a>
                        </li>
                    
                        <li>
                            <a href="../configurations/">Configurations</a>
                        </li>
                    
                        <li>
                            <a href="../cdc-ingestion/">CDC Ingestion</a>
                        </li>
                    
                        <li>
                            <a href="../metrics/">Metrics</a>
                        </li>
                    
                </ul>
        </div>
            
        
        
        
            
                <li>


                    <a class="top-menu chevron-toggle  collapsed" data-toggle="collapse" href="#Formats">
                        <span>Formats</span>
                    </a>
                </li>
        <div id="Formats" class="collapse in">
                <ul class="sub-menu">
                    
                        <li>
                            <a href="../formats-overview/">Overview</a>
                        </li>
                    
                        <li>
                            <a href="../iceberg-format/">Iceberg</a>
                        </li>
                    
                        <li>
                            <a href="../paimon-format/">Paimon</a>
                        </li>
                    
                        <li>
                            <a href="../mixed-iceberg-format/">Mixed-Iceberg</a>
                        </li>
                    
                        <li>
                            <a href="../mixed-hive-format/">Mixed-Hive</a>
                        </li>
                    
                </ul>
        </div>
            
        
        
        
            
                <li>


                    <a class="top-menu chevron-toggle  collapsed" data-toggle="collapse" href="#Flink">
                        <span>Flink</span>
                    </a>
                </li>
        <div id="Flink" class="collapse in">
                <ul class="sub-menu">
                    
                        <li>
                            <a href="../flink-getting-started/">Flink Getting Started</a>
                        </li>
                    
                        <li>
                            <a href="../flink-ddl/">Flink DDL</a>
                        </li>
                    
                        <li>
                            <a href="../flink-dml/">Flink DML</a>
                        </li>
                    
                        <li>
                            <a href="../flink-cdc-ingestion/">Flink CDC Ingestion</a>
                        </li>
                    
                        <li>
                            <a href="../flink-datastream/">Flink DataStream</a>
                        </li>
                    
                        <li>
                            <a href="../flink-using-logstore/">Using Logstore</a>
                        </li>
                    
                </ul>
        </div>
            
        
        
        
            
                <li>


                    <a class="top-menu chevron-toggle  collapsed" data-toggle="collapse" href="#Spark">
                        <span>Spark</span>
                    </a>
                </li>
        <div id="Spark" class="collapse in">
                <ul class="sub-menu">
                    
                        <li>
                            <a href="../spark-getting-started/">Spark Getting Started</a>
                        </li>
                    
                        <li>
                            <a href="../spark-configuration/">Spark Configuration</a>
                        </li>
                    
                        <li>
                            <a href="../spark-ddl/">Spark DDL</a>
                        </li>
                    
                        <li>
                            <a href="../spark-queries/">Spark Queries</a>
                        </li>
                    
                        <li>
                            <a href="../spark-writes/">Spark Writes</a>
                        </li>
                    
                </ul>
        </div>
            
        
        
        
            
                <li>
                    <a class="top-menu" id=""  href="../trino/">
                        <span>Trino</span>
                    </a>
                </li>
            
        
        </ul>
        </div>
    </div>
    
</div>

            
            <div id="content" class="markdown-body">
                <div class="margin-for-toc"><!--
 - Licensed to the Apache Software Foundation (ASF) under one or more
 - contributor license agreements.  See the NOTICE file distributed with
 - this work for additional information regarding copyright ownership.
 - The ASF licenses this file to You under the Apache License, Version 2.0
 - (the "License"); you may not use this file except in compliance with
 - the License.  You may obtain a copy of the License at
 -
 -   http://www.apache.org/licenses/LICENSE-2.0
 -
 - Unless required by applicable law or agreed to in writing, software
 - distributed under the License is distributed on an "AS IS" BASIS,
 - WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 - See the License for the specific language governing permissions and
 - limitations under the License.
 -->
<h1 id="using-tables">Using Tables</h1>
<p>The SQL execution tool <code>Terminal</code> is provided in AMS dashboard to help users quickly create, modify and delete tables.
It is also available in <a href="../spark-ddl/">Spark</a> and <a href="../flink-ddl/">Flink</a> and other engines to manage tables using SQL.</p>
<h2 id="create-table">Create table</h2>
<p>After logging into AMS dashboard, go to <code>Terminal</code>, enter the table creation statement and execute it to complete the table creation.
The following is an example of table creation:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">create</span> <span style="color:#66d9ef">table</span> test_db.test_log_store(
</span></span><span style="display:flex;"><span>  id int,
</span></span><span style="display:flex;"><span>  name string,
</span></span><span style="display:flex;"><span>  op_time <span style="color:#66d9ef">timestamp</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">primary</span> <span style="color:#66d9ef">key</span>(id)
</span></span><span style="display:flex;"><span>) <span style="color:#66d9ef">using</span> mixed_iceberg
</span></span><span style="display:flex;"><span>partitioned <span style="color:#66d9ef">by</span>(days(op_time))
</span></span><span style="display:flex;"><span>tblproperties(
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#39;log-store.enable&#39;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;true&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#39;log-store.type&#39;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;kafka&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#39;log-store.address&#39;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;127.0.0.1:9092&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#39;log-store.topic&#39;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;local_catalog.test_db.test_log_store.log_store&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#39;table.event-time-field&#39;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;op_time&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#39;table.watermark-allowed-lateness-second&#39;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;60&#39;</span>);
</span></span></code></pre></div><p>Currently, terminal uses Spark Engine for SQL execution. For more information on the syntax of creating tables, refer to <a href="../spark-ddl/#create-table">Spark DDL</a>. Different Catalogs create different table formats, refer to <a href="../managing-catalogs/#create-catalog">Create Catalog</a></p>
<h3 id="configure-logstore">Configure LogStore</h3>
<p>As described in <a href="../mixed-iceberg-format/">Mixed-Iceberg format</a>, Mixed-Iceberg format may consist of several components, and BaseStore and ChangeStore will be automatically created upon table creation.
LogStore, as an optional component, requires separate configuration to specify, The complete configuration for LogStore can be found in <a href="../configurations/#logstore-configurations">LogStore Configuration</a>.</p>
<p>In the example above, the Kafka cluster 127.0.0.1:9092 and the topic local_catalog.test_db.test_log_store.log_store are used as the LogStore for the new table.
Before executing the above statement, you need to manually create the corresponding topic in the Kafka cluster or enable the automatic creation of topics feature for the cluster.</p>
<h3 id="configure-watermark">Configure watermark</h3>
<p>Watermark is used to describe the write progress of a table. Specifically, it is a timestamp attribute on the table, indicating that all data with a timestamp smaller than the watermark has been written to the table.
It is generally used to observe the write progress of a table and can also serve as a trigger metric for downstream batch computing tasks.</p>
<p>In the example above, op_time is set as the event time field of the table, and the op_time of the written data is used to calculate the watermark of the table.
To handle out-of-order writes, the permitted lateness of data when calculating the watermark is set to one minute.
You can view the current watermark of the table in the table details on the AMS Dashboard at AMS dashboard.</p>
<p><img src="../images/admin/watermark_table_detail.png" alt="mixed-format-table-watermark"></p>
<p>You can also use the following SQL statement in the <code>Terminal</code> to query the watermark of a table:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SHOW</span> TBLPROPERTIES test_db.test_log_store (<span style="color:#e6db74">&#39;watermark.table&#39;</span>);
</span></span></code></pre></div><p>You can expect to get the following results:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>+-----------------+---------------+
</span></span><span style="display:flex;"><span>| key             | value         |
</span></span><span style="display:flex;"><span>+-----------------+---------------+
</span></span><span style="display:flex;"><span>| watermark.table | 1668579055000 |
</span></span><span style="display:flex;"><span>+-----------------+---------------+
</span></span></code></pre></div><div class="info">
    Watermark configuration is only supported in Mixed-Hive format and Mixed-Iceberg format, and is not supported in Iceberg format for now.
</div>
<h2 id="modify-table">Modify table</h2>
<p>After logging into the AMS dashboard, go to the <code>Terminal</code> and enter the
modification statement to complete the table modification. The current <code>Terminal</code> uses Spark Engine to execute SQL. For
more information on modifying tables, please refer to the syntax guide <a href="../spark-ddl#alter-statement">Spark DDL</a>.</p>
<h2 id="upgrade-a-hive-table">Upgrade a Hive table</h2>
<p>Amoro supports <a href="../mixed-hive-format/">Mixed-Hive format</a> table, which combines the capabilities of Hive formats to directly implement new table formats on top of Hive.</p>
<p>After logging into the AMS dashboard, select a table under a certain Hive Catalog from the <code>Tables</code> menu to perform the upgrade operation.</p>
<p><img src="../images/admin/hive-table-detail.png" alt="Hive Table Detail"></p>
<p>Click the <code>Upgrade</code> button in the upper right corner of the table details (this button is not displayed for Hive tables that have already been upgraded).</p>
<p><img src="../images/admin/hive-table-upgrade.png" alt="Hive Table Upgrade"></p>
<p>On the upgrade page, select the primary key for the table and add additional parameters, then click <code>OK</code> to complete the upgrade of the Hive table.</p>
<h2 id="configure-self-optimizing">Configure self-optimizing</h2>
<p>Amoro provides a self-optimizing feature, which requires an active optimizer in the Optimizer Group configured for the table.</p>
<h3 id="modify-optimizer-group">Modify optimizer group</h3>
<p>To use an optimizer launched under a specific optimizer group to perform self-optimizing, you need to modify the <code>self-optimizing.group</code> parameter of the table to specify a specific resource pool for the table.
The setting method is as follows:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">TABLE</span> test_db.test_log_store <span style="color:#66d9ef">set</span> tblproperties (
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;self-optimizing.group&#39;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;group_name&#39;</span>);
</span></span></code></pre></div><p>In defaultï¼Œ<code>'self-optimizing.group' = 'default'</code>ã€‚</p>
<h3 id="adjust-optimizing-resources">Adjust optimizing resources</h3>
<p>If there are multiple tables to be optimized under the same Optimizer Group, you can manually adjust the resource proportion of each table by adjusting the <code>quota</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">TABLE</span> test_db.test_log_store <span style="color:#66d9ef">set</span> tblproperties (
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;self-optimizing.quota&#39;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;0.1&#39;</span>);
</span></span></code></pre></div><p>For more information, please refer to <a href="../self-optimizing/#quota">Self-optimizing quota</a>ã€‚</p>
<h3 id="adjust-optimizing-parameters">Adjust optimizing parameters</h3>
<p>You can manually set parameters such as execution interval, task size, and execution timeout for different types of Optimize.
For example, to set the execution interval for minor optimizing, you can do the following:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">TABLE</span> test_db.test_log_store <span style="color:#66d9ef">set</span> tblproperties (
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;self-optimizing.minor.trigger.interval&#39;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;3600000&#39;</span>);
</span></span></code></pre></div><p>More optimization parameter adjustment refer to <a href="../configurations/#self-optimizing-configurations">Self-optimizing configuration</a>ã€‚</p>
<h3 id="enable-or-disable-self-optimizing">Enable or disable self-optimizing</h3>
<p>The Optimize of the table is enabled by default. If you want to disable the Optimize feature, execute the following command.
Conversely, you can re-enable it:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">TABLE</span> test_db.test_log_store <span style="color:#66d9ef">set</span> tblproperties (
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;self-optimizing.enabled&#39;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;false&#39;</span>);
</span></span></code></pre></div><h2 id="configure-data-expiration">Configure data expiration</h2>
<p>Amoro can periodically clean data based on the table&rsquo;s expiration policy, which includes properties such as whether to enable expiration, retention duration, expiration level, and the selection of the field for expiration.
it&rsquo;s also necessary for AMS to have the data expiration thread enabled. You can enable the &lsquo;data-expiration&rsquo; property in the configuration file</p>
<h3 id="enable-or-disable-data-expiration">Enable or disable data expiration</h3>
<p>By default, Amoro has data expiration disabled. If you want to enable data expiration, please execute the following command.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">TABLE</span> test_db.test_log_store <span style="color:#66d9ef">set</span> tblproperties (
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;data-expire.enabled&#39;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;true&#39;</span>);
</span></span></code></pre></div><h3 id="set-retention-period">Set retention period</h3>
<p>The configuration for data retention duration consists of a number and a unit. For example, &lsquo;90d&rsquo; represents retaining data for 90 days, and &lsquo;12h&rsquo; indicates 12 hours.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">TABLE</span> test_db.test_log_store <span style="color:#66d9ef">set</span> tblproperties (
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;data-expire.retention-time&#39;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;90d&#39;</span>);
</span></span></code></pre></div><h3 id="select-expiration-field">Select expiration field</h3>
<p>Data expiration requires users to specify a field for determining expiration.
In addition to supporting timestampz/timestamp field types for this purpose, it also supports string and long field type.
String field require a date pattern for proper parsing, with the default format being &lsquo;yyyy-MM-dd&rsquo;. Additionally, long fields can be chosen as the expiration event time, but you need to specify the timestamp&rsquo;s unit, which can be in <code>TIMESTAMP_MS</code> or <code>TIMESTAMP_S</code>.
Note that timestamp, timestampz, and long field types use UTC, while others use the local time zone.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">TABLE</span> test_db.test_log_store <span style="color:#66d9ef">set</span> tblproperties (
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;data-expire.field&#39;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;op_time&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">-- select string field
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">TABLE</span> test_db.test_log_store <span style="color:#66d9ef">set</span> tblproperties (
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;data-expire.field&#39;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;op_time&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;data-expire.datetime-string-pattern&#39;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;yyyy-MM-dd&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">-- select long field
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">TABLE</span> test_db.test_log_store <span style="color:#66d9ef">set</span> tblproperties (
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;data-expire.field&#39;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;op_time&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;data-expire.datetime-number-format&#39;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;TIMESTAMP_MS&#39;</span>);
</span></span></code></pre></div><h3 id="adjust-expiration-level">Adjust expiration level</h3>
<p>Data expiration supports two levels, including <code>PARTITION</code> and <code>FILE</code>. The default level is <code>PARTITION</code>, which means that AMS deletes files only when all the files within a partition have expired.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">TABLE</span> test_db.test_log_store <span style="color:#66d9ef">set</span> tblproperties (
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;data-expire.level&#39;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;partition&#39;</span>);
</span></span></code></pre></div><h3 id="specify-start-time">Specify start time</h3>
<p>Amoro expire data since <code>LAST_COMMIT_TIME</code> or <code>CURRENT_TIME</code>. <code>LAST_COMMIT_TIME</code> will follow the timestamp of the table&rsquo;s most recent snapshot as the start time of the expiration, which ensures that the table has <code>data-expire.retention-time</code> data; while <code>CURRENT_TIME</code> will follow the current time of the service.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">TABLE</span> test_db.test_log_store <span style="color:#66d9ef">set</span> tblproperties (
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;data-expire.base-on-rule&#39;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;CURRENT_TIME&#39;</span>);
</span></span></code></pre></div><h2 id="delete-table">Delete table</h2>
<p>After logging into the AMS Dashboard. To modify a table, enter the modification statement in the <code>terminal</code> and execute it.</p>
<p>Here is an example of how to delete a tableï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">DROP</span> <span style="color:#66d9ef">TABLE</span> test_db.test_log_store;
</span></span></code></pre></div><p>The current terminal is using the Spark engine to execute SQL. For more information about deleting tables, you can refer to  <a href="../spark-ddl/#drop-table">Spark DDL</a>.</p>
<h2 id="explore-table-details">Explore table details</h2>
<p>The Amoro Tables details page provides multiple tabs to display the status of the table from various dimensions, mainly including:</p>
<table>
  <thead>
      <tr>
          <th><strong>Tab Name</strong></th>
          <th><strong>Description</strong></th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Details</td>
          <td>Display the table&rsquo;s schema, primary key configuration, partition configuration, properties; as well as the metric information of the files stored in ChangeStore and BaseStore, including the number of files and average file size, as well as the latest submission time of the files.</td>
      </tr>
      <tr>
          <td>Files</td>
          <td>Display all partitions and files of the table.</td>
      </tr>
      <tr>
          <td>Snapshots</td>
          <td>Display all snapshots of the table, which can be filtered by branch and tag.</td>
      </tr>
      <tr>
          <td>Optimizing</td>
          <td>Display all the self-optimizing processes of the table, each record shows the number and average size of files before and after Optimize, as well as the execution time of each process.</td>
      </tr>
      <tr>
          <td>Operations</td>
          <td>Display the current table&rsquo;s DDL historical change records.</td>
      </tr>
  </tbody>
</table>
<p><img src="../images/admin/table_metrics.png" alt="table-details"></p>
<p><img src="../images/admin/table_optimizer_history.png" alt="table-optimize-history"></p>
<h2 id="explore-self-optimizing-status">Explore self-optimizing status</h2>
<p>The Optimizing page displays self-optimizing status of all tables.
<img src="../images/admin/optimizer_metrics.png" alt="optimizing-metrics"></p>
<ul>
<li><strong>Optimizing Status</strong>: The current optimizing status of the table, including idle, pending, planning, minor, major, full, committing.
<ul>
<li>idle: means that self-optimizing is not required on the table.</li>
<li>pending: means that self-optimizing is required on the table and is waiting for resources.</li>
<li>planning: means that self-optimizing process is being planed.</li>
<li>minor: means that minor optimizing is being executed on the table.</li>
<li>major: means that major optimizing is being executed on the table.</li>
<li>full: means that full optimizing is being executed on the table.</li>
<li>committing: means that self-optimizing process is being committed.</li>
</ul>
</li>
<li><strong>Duration</strong>: The duration of the current status.</li>
<li><strong>File Count</strong>: The total number of files involved in the current Self-optimizing, including base, insert, eq-delete, and pos-delete file types.</li>
<li><strong>File Size</strong>: The total size of files involved in the current self-optimizing.</li>
<li><strong>Quota</strong>: The proportion of self-optimizing execution time executed per unit time.</li>
<li><strong>Quota Occupation</strong>: The actual Quota used for self-optimizing during execution of the table in the last hour. When optimizer resources are sufficient and the table requires more resources for self-optimizing, this value will be greater than 100%. When resources are scarce or the table requires fewer resources for self-optimizing, this value will be less than 100%.</li>
</ul>
</div>
                
                    














<div id="toc" class="markdown-body">
    <div id="full">
        <nav id="TableOfContents">
  <ul>
    <li><a href="#create-table">Create table</a>
      <ul>
        <li><a href="#configure-logstore">Configure LogStore</a></li>
        <li><a href="#configure-watermark">Configure watermark</a></li>
      </ul>
    </li>
    <li><a href="#modify-table">Modify table</a></li>
    <li><a href="#upgrade-a-hive-table">Upgrade a Hive table</a></li>
    <li><a href="#configure-self-optimizing">Configure self-optimizing</a>
      <ul>
        <li><a href="#modify-optimizer-group">Modify optimizer group</a></li>
        <li><a href="#adjust-optimizing-resources">Adjust optimizing resources</a></li>
        <li><a href="#adjust-optimizing-parameters">Adjust optimizing parameters</a></li>
        <li><a href="#enable-or-disable-self-optimizing">Enable or disable self-optimizing</a></li>
      </ul>
    </li>
    <li><a href="#configure-data-expiration">Configure data expiration</a>
      <ul>
        <li><a href="#enable-or-disable-data-expiration">Enable or disable data expiration</a></li>
        <li><a href="#set-retention-period">Set retention period</a></li>
        <li><a href="#select-expiration-field">Select expiration field</a></li>
        <li><a href="#adjust-expiration-level">Adjust expiration level</a></li>
        <li><a href="#specify-start-time">Specify start time</a></li>
      </ul>
    </li>
    <li><a href="#delete-table">Delete table</a></li>
    <li><a href="#explore-table-details">Explore table details</a></li>
    <li><a href="#explore-self-optimizing-status">Explore self-optimizing status</a></li>
  </ul>
</nav>
    </div>
</div>

                
            </div>
        </div>
    </section>
</body>















<script src="https://amoro.apache.org/docs/version_bump_when_releasing//js/jquery-1.11.0.js"></script>


<script src="https://amoro.apache.org/docs/version_bump_when_releasing//js/jquery.easing.min.js"></script>


<script type="text/javascript" src="https://amoro.apache.org/docs/version_bump_when_releasing//js/search.js"></script>


<script src="https://amoro.apache.org/docs/version_bump_when_releasing//js/bootstrap.min.js"></script>


<script src="https://amoro.apache.org/docs/version_bump_when_releasing//js/iceberg-theme.js"></script>



</html>